<div class="group-detail-container">
  <header class="group-header">
    <div class="header-content">
      <div class="header-left">
        <a routerLink="/groups" class="back-link">‚Üê Back to Groups</a>
        <h1>{{ group?.name || 'Loading...' }}</h1>
      </div>
      <div class="user-menu" *ngIf="currentUser$ | async as user">
        <span class="user-name">{{ user.name }}</span>
        <button class="btn-logout" (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <main class="group-main">
    <div class="group-content">
      <div class="loading" *ngIf="isLoading">Loading group details...</div>

      <div class="content-grid" *ngIf="!isLoading && group">
        <!-- Members Section -->
        <div class="card">
          <div class="card-header">
            <h2>Members</h2>
          </div>
          <div class="card-body">
            <div class="member-list" *ngIf="group.members && group.members.length > 0">
              <div class="member-item" *ngFor="let member of group.members">
                <div class="member-avatar">{{ member.name.charAt(0).toUpperCase() }}</div>
                <div class="member-info">
                  <div class="member-name">{{ member.name }}</div>
                  <div class="member-email">{{ member.email }}</div>
                </div>
              </div>
            </div>
            <div class="empty-message" *ngIf="!group.members || group.members.length === 0">
              No members yet
            </div>
          </div>
        </div>

        <!-- Balances Section -->
        <div class="card">
          <div class="card-header">
            <h2>Balances</h2>
          </div>
          <div class="card-body">
            <div class="balance-list" *ngIf="balances.length > 0">
              <div class="balance-item" *ngFor="let balance of balances">
                <div class="balance-name">{{ balance.name }}</div>
                <div class="balance-amount" [ngClass]="getBalanceClass(balance.balance)">
                  {{ formatBalance(balance.balance) }}
                </div>
              </div>
            </div>
            <div class="empty-message" *ngIf="balances.length === 0">
              No balances to show
            </div>
          </div>
        </div>

        <!-- Expenses Section -->
        <div class="card expenses-card">
          <div class="card-header">
            <h2>Expenses</h2>
            <button class="btn-add" (click)="openAddExpenseDialog()">+ Add Expense</button>
          </div>
          <div class="card-body">
            <div class="expense-list" *ngIf="expenses.length > 0">
              <div class="expense-item" *ngFor="let expense of expenses">
                <div class="expense-main">
                  <div class="expense-icon">üí∞</div>
                  <div class="expense-info">
                    <div class="expense-description">{{ expense.description }}</div>
                    <div class="expense-meta">
                      Paid by {{ expense.paidByName }} on {{ expense.date | date: 'mediumDate' }}
                    </div>
                  </div>
                  <div class="expense-amount">${{ expense.amount.toFixed(2) }}</div>
                </div>
                <div class="expense-splits" *ngIf="expense.splits && expense.splits.length > 0">
                  <div class="split-item" *ngFor="let split of expense.splits">
                    <span class="split-name">{{ split.userName }}</span>
                    <span class="split-share">${{ split.share.toFixed(2) }}</span>
                    <span class="split-status" [class.paid]="split.paid">
                      {{ split.paid ? '‚úì Paid' : 'Unpaid' }}
                    </span>
                  </div>
                </div>
              </div>
            </div>
            <div class="empty-message" *ngIf="expenses.length === 0">
              No expenses yet. Add your first expense!
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Expense Dialog -->
  <div class="modal-overlay" *ngIf="showAddExpenseDialog" (click)="closeAddExpenseDialog()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Add Expense</h2>
        <button class="btn-close" (click)="closeAddExpenseDialog()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="description">Description *</label>
          <input
            id="description"
            type="text"
            [(ngModel)]="newExpense.description"
            class="form-control"
            placeholder="e.g., Dinner at restaurant"
          />
        </div>

        <div class="form-group">
          <label for="amount">Amount *</label>
          <input
            id="amount"
            type="number"
            [(ngModel)]="newExpense.amount"
            class="form-control"
            placeholder="0.00"
            step="0.01"
            min="0.01"
          />
        </div>

        <div class="form-group">
          <label for="paidBy">Paid By *</label>
          <select id="paidBy" [(ngModel)]="newExpense.paidById" class="form-control">
            <option value="">Select member</option>
            <option *ngFor="let member of group?.members" [value]="member.id">
              {{ member.name }}
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="date">Date *</label>
          <input
            id="date"
            type="date"
            [(ngModel)]="newExpense.date"
            class="form-control"
          />
        </div>

        <div class="info-message">
          The expense will be split equally among all group members.
        </div>

        <div class="error-message" *ngIf="errorMessage">{{ errorMessage }}</div>
      </div>
      <div class="modal-footer">
        <button class="btn-secondary" (click)="closeAddExpenseDialog()">Cancel</button>
        <button class="btn-primary" (click)="addExpense()" [disabled]="isLoading">
          {{ isLoading ? 'Adding...' : 'Add Expense' }}
        </button>
      </div>
    </div>
  </div>
</div>
